<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Java - DA FlatBuffers</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.1/github-markdown-dark.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #000000;
      --bg-secondary: rgba(42, 42, 45, 0.72);
      --bg-tertiary: rgba(66, 66, 69, 0.72);
      --accent-primary: #3b82f6;
      --accent-secondary: #60a5fa;
      --text-primary: #F5F5F7;
      --text-secondary: rgba(255, 255, 255, 0.6);
      --border-color: rgba(59, 130, 246, 0.3);
      --glow-color: rgba(59, 130, 246, 0.15);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(59, 130, 246, 0.04) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(59, 130, 246, 0.03) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* Grid pattern overlay */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image:
        linear-gradient(rgba(59, 130, 246, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.02) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }

    .page-container {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      margin-bottom: 30px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--accent-secondary);
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .back-link:hover {
      background: var(--bg-tertiary);
      border-color: var(--accent-primary);
      transform: translateY(-1px);
    }

    .markdown-body {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 48px;
    }

    .markdown-body h1,
    .markdown-body h2,
    .markdown-body h3,
    .markdown-body h4 {
      color: var(--text-primary);
      border-bottom-color: var(--border-color);
      font-weight: 600;
    }

    .markdown-body h1 {
      background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2.2em;
      margin-bottom: 24px;
    }

    .markdown-body a {
      color: var(--accent-secondary);
    }

    .markdown-body a:hover {
      color: var(--accent-primary);
    }

    .markdown-body code {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      padding: 2px 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9em;
    }

    .markdown-body pre {
      background: var(--bg-primary) !important;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
    }

    .markdown-body pre code {
      background: transparent;
      border: none;
      padding: 0;
      font-size: 0.85em;
      line-height: 1.6;
    }

    .markdown-body table {
      border-collapse: collapse;
      width: 100%;
      margin: 20px 0;
    }

    .markdown-body table th,
    .markdown-body table td {
      border: 1px solid var(--border-color);
      padding: 12px 16px;
      text-align: left;
    }

    .markdown-body table th {
      background: var(--bg-tertiary);
      font-weight: 600;
      color: var(--accent-secondary);
    }

    .markdown-body table tr:nth-child(even) {
      background: rgba(59, 130, 246, 0.03);
    }

    .markdown-body blockquote {
      border-left: 4px solid var(--accent-primary);
      background: var(--bg-tertiary);
      padding: 16px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }

    .markdown-body hr {
      border: none;
      height: 1px;
      background: var(--border-color);
      margin: 32px 0;
    }

    .markdown-body ul, .markdown-body ol {
      padding-left: 24px;
    }

    .markdown-body li {
      margin: 8px 0;
    }

    @media (max-width: 768px) {
      .page-container {
        padding: 20px 16px;
      }
      .markdown-body {
        padding: 24px;
        border-radius: 12px;
      }
      .markdown-body h1 {
        font-size: 1.8em;
      }
    }
  </style>
</head>
<body>
  <div class="page-container">
    <a href="https://digitalarsenal.github.io/flatbuffers/" class="back-link">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to DA FlatBuffers
    </a>
    <article class="markdown-body"><h1 id="java-integration-guide">Java Integration Guide</h1>
<p>Integrate the FlatBuffers encryption WASM module into Java applications using <a href="https://github.com/nickmccoll/chicory">Chicory</a>, a pure Java WebAssembly runtime.</p>
<h2 id="why-chicory">Why Chicory?</h2>
<ul>
<li><strong>Pure Java</strong> - No JNI, no native dependencies</li>
<li><strong>JVM optimized</strong> - Designed for Java performance</li>
<li><strong>Easy deployment</strong> - Just add a Maven dependency</li>
<li><strong>GraalVM compatible</strong> - Works with native-image</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Java 17 or later</li>
<li>Maven or Gradle</li>
<li><code>flatc-encryption.wasm</code> binary</li>
</ul>
<h2 id="installation">Installation</h2>
<p><strong>Maven:</strong></p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.dylibso.chicory&lt;/groupId&gt;
    &lt;artifactId&gt;runtime&lt;/artifactId&gt;
    &lt;version&gt;1.5.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p><strong>Gradle:</strong></p>
<pre><code class="language-groovy">implementation &#39;com.dylibso.chicory:runtime:1.5.3&#39;
</code></pre>
<h2 id="quick-start">Quick Start</h2>
<pre><code class="language-java">import com.dylibso.chicory.runtime.Instance;
import com.dylibso.chicory.runtime.Module;
import com.dylibso.chicory.runtime.Memory;
import com.dylibso.chicory.wasm.types.Value;

import java.nio.file.Files;
import java.nio.file.Path;
import java.security.SecureRandom;

public class QuickStart {
    public static void main(String[] args) throws Exception {
        // Load WASM module
        byte[] wasmBytes = Files.readAllBytes(Path.of(&quot;flatc-encryption.wasm&quot;));
        Module module = Module.builder(wasmBytes).build();
        Instance instance = module.instantiate();

        // Get memory and functions
        Memory memory = instance.memory();
        var malloc = instance.export(&quot;malloc&quot;);
        var free = instance.export(&quot;free&quot;);
        var encrypt = instance.export(&quot;wasi_encrypt_bytes&quot;);
        var decrypt = instance.export(&quot;wasi_decrypt_bytes&quot;);

        // Generate key and IV
        SecureRandom random = new SecureRandom();
        byte[] key = new byte[32];
        byte[] iv = new byte[16];
        random.nextBytes(key);
        random.nextBytes(iv);

        byte[] plaintext = &quot;Hello, FlatBuffers!&quot;.getBytes();

        // Allocate WASM memory
        int keyPtr = (int) malloc.apply(Value.i32(32))[0].asInt();
        int ivPtr = (int) malloc.apply(Value.i32(16))[0].asInt();
        int dataPtr = (int) malloc.apply(Value.i32(plaintext.length))[0].asInt();

        // Write to memory
        memory.write(keyPtr, key);
        memory.write(ivPtr, iv);
        memory.write(dataPtr, plaintext);

        // Encrypt
        encrypt.apply(
            Value.i32(keyPtr),
            Value.i32(ivPtr),
            Value.i32(dataPtr),
            Value.i32(plaintext.length)
        );

        // Read encrypted data
        byte[] ciphertext = memory.readBytes(dataPtr, plaintext.length);
        System.out.println(&quot;Encrypted: &quot; + bytesToHex(ciphertext));

        // Decrypt
        decrypt.apply(
            Value.i32(keyPtr),
            Value.i32(ivPtr),
            Value.i32(dataPtr),
            Value.i32(plaintext.length)
        );

        // Read decrypted data
        byte[] decrypted = memory.readBytes(dataPtr, plaintext.length);
        System.out.println(&quot;Decrypted: &quot; + new String(decrypted));

        // Clean up
        free.apply(Value.i32(keyPtr));
        free.apply(Value.i32(ivPtr));
        free.apply(Value.i32(dataPtr));
    }

    private static String bytesToHex(byte[] bytes) {
        StringBuilder sb = new StringBuilder();
        for (byte b : bytes) {
            sb.append(String.format(&quot;%02x&quot;, b));
        }
        return sb.toString();
    }
}
</code></pre>
<h2 id="complete-module-wrapper">Complete Module Wrapper</h2>
<pre><code class="language-java">package com.example.encryption;

import com.dylibso.chicory.runtime.Instance;
import com.dylibso.chicory.runtime.Module;
import com.dylibso.chicory.runtime.Memory;
import com.dylibso.chicory.runtime.ExportFunction;
import com.dylibso.chicory.wasm.types.Value;

import java.nio.file.Files;
import java.nio.file.Path;
import java.security.SecureRandom;

/**
 * FlatBuffers Encryption Module for Java.
 *
 * Provides cryptographic operations via the Crypto++ WASM module:
 * - AES-256-CTR symmetric encryption
 * - X25519 ECDH key exchange
 * - secp256k1 ECDH and ECDSA signatures
 * - P-256 ECDH and ECDSA signatures
 * - Ed25519 signatures
 */
public class EncryptionModule implements AutoCloseable {

    // Key and signature sizes
    public static final int AES_KEY_SIZE = 32;
    public static final int AES_IV_SIZE = 16;
    public static final int SHA256_SIZE = 32;

    public static final int X25519_PRIVATE_KEY_SIZE = 32;
    public static final int X25519_PUBLIC_KEY_SIZE = 32;

    public static final int SECP256K1_PRIVATE_KEY_SIZE = 32;
    public static final int SECP256K1_PUBLIC_KEY_SIZE = 33;
    public static final int SECP256K1_SIGNATURE_MAX_SIZE = 72;

    public static final int ED25519_PRIVATE_KEY_SIZE = 64;
    public static final int ED25519_PUBLIC_KEY_SIZE = 32;
    public static final int ED25519_SIGNATURE_SIZE = 64;

    private final Instance instance;
    private final Memory memory;
    private final ExportFunction malloc;
    private final ExportFunction free;

    // Encryption
    private final ExportFunction encrypt;
    private final ExportFunction decrypt;

    // Hash
    private final ExportFunction sha256;
    private final ExportFunction hkdf;

    // X25519
    private final ExportFunction x25519Generate;
    private final ExportFunction x25519Shared;

    // secp256k1
    private final ExportFunction secp256k1Generate;
    private final ExportFunction secp256k1Shared;
    private final ExportFunction secp256k1Sign;
    private final ExportFunction secp256k1Verify;

    // Ed25519
    private final ExportFunction ed25519Generate;
    private final ExportFunction ed25519Sign;
    private final ExportFunction ed25519Verify;

    /**
     * Create a new encryption module from WASM bytes.
     */
    public EncryptionModule(byte[] wasmBytes) {
        Module module = Module.builder(wasmBytes).build();
        this.instance = module.instantiate();
        this.memory = instance.memory();

        // Core
        this.malloc = instance.export(&quot;malloc&quot;);
        this.free = instance.export(&quot;free&quot;);

        // Encryption
        this.encrypt = instance.export(&quot;wasi_encrypt_bytes&quot;);
        this.decrypt = instance.export(&quot;wasi_decrypt_bytes&quot;);

        // Hash
        this.sha256 = instance.export(&quot;wasi_sha256&quot;);
        this.hkdf = instance.export(&quot;wasi_hkdf&quot;);

        // X25519
        this.x25519Generate = instance.export(&quot;wasi_x25519_generate_keypair&quot;);
        this.x25519Shared = instance.export(&quot;wasi_x25519_shared_secret&quot;);

        // secp256k1
        this.secp256k1Generate = instance.export(&quot;wasi_secp256k1_generate_keypair&quot;);
        this.secp256k1Shared = instance.export(&quot;wasi_secp256k1_shared_secret&quot;);
        this.secp256k1Sign = instance.export(&quot;wasi_secp256k1_sign&quot;);
        this.secp256k1Verify = instance.export(&quot;wasi_secp256k1_verify&quot;);

        // Ed25519
        this.ed25519Generate = instance.export(&quot;wasi_ed25519_generate_keypair&quot;);
        this.ed25519Sign = instance.export(&quot;wasi_ed25519_sign&quot;);
        this.ed25519Verify = instance.export(&quot;wasi_ed25519_verify&quot;);
    }

    /**
     * Create from file path.
     */
    public static EncryptionModule fromFile(String path) throws Exception {
        byte[] wasmBytes = Files.readAllBytes(Path.of(path));
        return new EncryptionModule(wasmBytes);
    }

    // Key pair classes

    public record X25519KeyPair(byte[] privateKey, byte[] publicKey) {}
    public record Ed25519KeyPair(byte[] privateKey, byte[] publicKey) {}
    public record Secp256k1KeyPair(byte[] privateKey, byte[] publicKey) {}

    // Symmetric Encryption

    /**
     * Encrypt data using AES-256-CTR.
     *
     * @param key 32-byte encryption key
     * @param iv 16-byte initialization vector
     * @param data Data to encrypt
     * @return Encrypted data
     */
    public byte[] encrypt(byte[] key, byte[] iv, byte[] data) {
        if (key.length != AES_KEY_SIZE) {
            throw new IllegalArgumentException(&quot;Key must be &quot; + AES_KEY_SIZE + &quot; bytes&quot;);
        }
        if (iv.length != AES_IV_SIZE) {
            throw new IllegalArgumentException(&quot;IV must be &quot; + AES_IV_SIZE + &quot; bytes&quot;);
        }

        int keyPtr = allocate(key.length);
        int ivPtr = allocate(iv.length);
        int dataPtr = allocate(data.length);

        try {
            memory.write(keyPtr, key);
            memory.write(ivPtr, iv);
            memory.write(dataPtr, data);

            Value[] result = encrypt.apply(
                Value.i32(keyPtr),
                Value.i32(ivPtr),
                Value.i32(dataPtr),
                Value.i32(data.length)
            );

            if (result[0].asInt() != 0) {
                throw new RuntimeException(&quot;Encryption failed&quot;);
            }

            return memory.readBytes(dataPtr, data.length);
        } finally {
            free(keyPtr);
            free(ivPtr);
            free(dataPtr);
        }
    }

    /**
     * Decrypt data using AES-256-CTR.
     */
    public byte[] decrypt(byte[] key, byte[] iv, byte[] data) {
        // CTR mode is symmetric
        return encrypt(key, iv, data);
    }

    // Hash Functions

    /**
     * Compute SHA-256 hash.
     */
    public byte[] sha256(byte[] data) {
        int dataPtr = allocate(data.length);
        int outPtr = allocate(SHA256_SIZE);

        try {
            memory.write(dataPtr, data);
            sha256.apply(
                Value.i32(dataPtr),
                Value.i32(data.length),
                Value.i32(outPtr)
            );
            return memory.readBytes(outPtr, SHA256_SIZE);
        } finally {
            free(dataPtr);
            free(outPtr);
        }
    }

    /**
     * Derive key using HKDF-SHA256.
     *
     * @param ikm Input key material
     * @param salt Optional salt (can be null)
     * @param info Context info
     * @param length Output length
     * @return Derived key
     */
    public byte[] hkdf(byte[] ikm, byte[] salt, byte[] info, int length) {
        int ikmPtr = allocate(ikm.length);
        memory.write(ikmPtr, ikm);

        int saltPtr = 0;
        int saltLen = 0;
        if (salt != null &amp;&amp; salt.length &gt; 0) {
            saltPtr = allocate(salt.length);
            memory.write(saltPtr, salt);
            saltLen = salt.length;
        }

        int infoPtr = allocate(info.length);
        memory.write(infoPtr, info);

        int outPtr = allocate(length);

        try {
            hkdf.apply(
                Value.i32(ikmPtr), Value.i32(ikm.length),
                Value.i32(saltPtr), Value.i32(saltLen),
                Value.i32(infoPtr), Value.i32(info.length),
                Value.i32(outPtr), Value.i32(length)
            );
            return memory.readBytes(outPtr, length);
        } finally {
            free(ikmPtr);
            if (saltPtr != 0) free(saltPtr);
            free(infoPtr);
            free(outPtr);
        }
    }

    // X25519 Key Exchange

    /**
     * Generate X25519 key pair.
     */
    public X25519KeyPair x25519GenerateKeyPair() {
        int privPtr = allocate(X25519_PRIVATE_KEY_SIZE);
        int pubPtr = allocate(X25519_PUBLIC_KEY_SIZE);

        try {
            Value[] result = x25519Generate.apply(
                Value.i32(privPtr),
                Value.i32(pubPtr)
            );

            if (result[0].asInt() != 0) {
                throw new RuntimeException(&quot;Key generation failed&quot;);
            }

            return new X25519KeyPair(
                memory.readBytes(privPtr, X25519_PRIVATE_KEY_SIZE),
                memory.readBytes(pubPtr, X25519_PUBLIC_KEY_SIZE)
            );
        } finally {
            free(privPtr);
            free(pubPtr);
        }
    }

    /**
     * Compute X25519 shared secret.
     */
    public byte[] x25519SharedSecret(byte[] privateKey, byte[] publicKey) {
        int privPtr = allocate(privateKey.length);
        int pubPtr = allocate(publicKey.length);
        int outPtr = allocate(32);

        try {
            memory.write(privPtr, privateKey);
            memory.write(pubPtr, publicKey);

            Value[] result = x25519Shared.apply(
                Value.i32(privPtr),
                Value.i32(pubPtr),
                Value.i32(outPtr)
            );

            if (result[0].asInt() != 0) {
                throw new RuntimeException(&quot;Shared secret computation failed&quot;);
            }

            return memory.readBytes(outPtr, 32);
        } finally {
            free(privPtr);
            free(pubPtr);
            free(outPtr);
        }
    }

    // Ed25519 Signatures

    /**
     * Generate Ed25519 key pair.
     */
    public Ed25519KeyPair ed25519GenerateKeyPair() {
        int privPtr = allocate(ED25519_PRIVATE_KEY_SIZE);
        int pubPtr = allocate(ED25519_PUBLIC_KEY_SIZE);

        try {
            Value[] result = ed25519Generate.apply(
                Value.i32(privPtr),
                Value.i32(pubPtr)
            );

            if (result[0].asInt() != 0) {
                throw new RuntimeException(&quot;Key generation failed&quot;);
            }

            return new Ed25519KeyPair(
                memory.readBytes(privPtr, ED25519_PRIVATE_KEY_SIZE),
                memory.readBytes(pubPtr, ED25519_PUBLIC_KEY_SIZE)
            );
        } finally {
            free(privPtr);
            free(pubPtr);
        }
    }

    /**
     * Sign with Ed25519.
     */
    public byte[] ed25519Sign(byte[] privateKey, byte[] message) {
        int privPtr = allocate(privateKey.length);
        int msgPtr = allocate(message.length);
        int sigPtr = allocate(ED25519_SIGNATURE_SIZE);

        try {
            memory.write(privPtr, privateKey);
            memory.write(msgPtr, message);

            Value[] result = ed25519Sign.apply(
                Value.i32(privPtr),
                Value.i32(msgPtr),
                Value.i32(message.length),
                Value.i32(sigPtr)
            );

            if (result[0].asInt() != 0) {
                throw new RuntimeException(&quot;Signing failed&quot;);
            }

            return memory.readBytes(sigPtr, ED25519_SIGNATURE_SIZE);
        } finally {
            free(privPtr);
            free(msgPtr);
            free(sigPtr);
        }
    }

    /**
     * Verify Ed25519 signature.
     */
    public boolean ed25519Verify(byte[] publicKey, byte[] message, byte[] signature) {
        int pubPtr = allocate(publicKey.length);
        int msgPtr = allocate(message.length);
        int sigPtr = allocate(signature.length);

        try {
            memory.write(pubPtr, publicKey);
            memory.write(msgPtr, message);
            memory.write(sigPtr, signature);

            Value[] result = ed25519Verify.apply(
                Value.i32(pubPtr),
                Value.i32(msgPtr),
                Value.i32(message.length),
                Value.i32(sigPtr)
            );

            return result[0].asInt() == 0;
        } finally {
            free(pubPtr);
            free(msgPtr);
            free(sigPtr);
        }
    }

    // Helpers

    private int allocate(int size) {
        Value[] result = malloc.apply(Value.i32(size));
        int ptr = result[0].asInt();
        if (ptr == 0) {
            throw new OutOfMemoryError(&quot;WASM malloc returned null&quot;);
        }
        return ptr;
    }

    private void free(int ptr) {
        free.apply(Value.i32(ptr));
    }

    @Override
    public void close() {
        // Chicory handles cleanup automatically
    }
}
</code></pre>
<h2 id="template-project-structure">Template Project Structure</h2>
<pre><code>myproject/
├── pom.xml
├── src/
│   └── main/
│       ├── java/
│       │   └── com/example/
│       │       ├── Main.java
│       │       └── encryption/
│       │           └── EncryptionModule.java
│       └── resources/
│           └── flatc-encryption.wasm
└── src/
    └── test/
        └── java/
            └── com/example/
                └── EncryptionTest.java
</code></pre>
<p><strong>pom.xml:</strong></p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0
         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;flatbuffers-encryption&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.dylibso.chicory&lt;/groupId&gt;
            &lt;artifactId&gt;runtime&lt;/artifactId&gt;
            &lt;version&gt;1.5.3&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
            &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;
            &lt;version&gt;5.10.0&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="basic-encryption">Basic Encryption</h3>
<pre><code class="language-java">var module = EncryptionModule.fromFile(&quot;flatc-encryption.wasm&quot;);

SecureRandom random = new SecureRandom();
byte[] key = new byte[32];
byte[] iv = new byte[16];
random.nextBytes(key);
random.nextBytes(iv);

byte[] plaintext = &quot;Secret message&quot;.getBytes();
byte[] ciphertext = module.encrypt(key, iv, plaintext);
byte[] decrypted = module.decrypt(key, iv, ciphertext);

assert Arrays.equals(plaintext, decrypted);
</code></pre>
<h3 id="end-to-end-encryption">End-to-End Encryption</h3>
<pre><code class="language-java">var module = EncryptionModule.fromFile(&quot;flatc-encryption.wasm&quot;);

// Generate key pairs
var alice = module.x25519GenerateKeyPair();
var bob = module.x25519GenerateKeyPair();

// Compute shared secrets
byte[] aliceShared = module.x25519SharedSecret(alice.privateKey(), bob.publicKey());
byte[] bobShared = module.x25519SharedSecret(bob.privateKey(), alice.publicKey());

assert Arrays.equals(aliceShared, bobShared);

// Derive encryption key
byte[] encryptionKey = module.hkdf(aliceShared, null, &quot;encryption-v1&quot;.getBytes(), 32);

// Encrypt message
byte[] iv = new byte[16];
new SecureRandom().nextBytes(iv);
byte[] ciphertext = module.encrypt(encryptionKey, iv, &quot;Hello Bob!&quot;.getBytes());

// Decrypt
byte[] decrypted = module.decrypt(encryptionKey, iv, ciphertext);
System.out.println(new String(decrypted)); // &quot;Hello Bob!&quot;
</code></pre>
<h2 id="performance-tips">Performance Tips</h2>
<ol>
<li><strong>Reuse module instances</strong> - Module loading is expensive</li>
<li><strong>Use try-with-resources</strong> - Ensures proper cleanup</li>
<li><strong>Consider thread safety</strong> - Chicory instances are not thread-safe</li>
</ol>
<pre><code class="language-java">// Good: Reuse instance
var module = EncryptionModule.fromFile(&quot;wasm&quot;);
for (var item : items) {
    module.encrypt(key, iv, item);
}

// Bad: Create new instance each time
for (var item : items) {
    var module = EncryptionModule.fromFile(&quot;wasm&quot;); // Slow!
    module.encrypt(key, iv, item);
}
</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="function-not-found">"Function not found"</h3>
<p>Check that you&#39;re using the correct export names (wasi_* prefix).</p>
<h3 id="memory-access-out-of-bounds">"Memory access out of bounds"</h3>
<p>Ensure allocated memory is valid:</p>
<pre><code class="language-java">int ptr = allocate(size);
if (ptr == 0) {
    throw new RuntimeException(&quot;Allocation failed&quot;);
}
</code></pre>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="https://github.com/nickmccoll/chicory">Chicory Documentation</a></li>
<li><a href="README.md#api-reference">API Reference</a></li>
<li><a href="README.md#security-considerations">Security Considerations</a></li>
</ul>
</article>
  </div>
</body>
</html>